<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>ELKS FAQ</title>
                
  <meta name="Author" content="Brian Candler">
         
  <meta name="KeyWords" content="elks,faq,linux,kernel,8086">
</head>
 <body bgcolor="#c0d0e0">
 
<h1 align="Center">ELKS FAQ</h1>
    This a list of answers to Frequently Asked Questions about ELKS, also 
known as Linux-8086.   
<p> This FAQ is maintained by Alistair Riddoch, based on the original by Brian
Candler; please send all updates to <a href="mailto:ajr@ecs.soton.ac.uk">
  ajr@ecs.soton.ac.uk</a>. The latest version of this document is available
 at <a href="http://www.ecs.soton.ac.uk/elks"> http://www.ecs.soton.ac.uk/elks</a>
  . Note that ELKS is in the very early stages of development and this information
 is likely to become out of date rapidly. </p>
 
<p> Additional information can be found at the ELKS home page at <a href="http://www.uk.linux.org/ELKS-Home/index.html"></a><a href="http://elks.sourceforge.net/">
  http://elks.sourceforge.net/</a>. </p>
 
<p> There is a mailing list. To subscribe, send a message to <tt>majordomo@vger.rutgers.edu</tt>
   containing the words <b>subscribe linux-8086</b> in the body. Archives 
of the mailing list can be found at <a href="http://epocha.pd.mcs.net/Linux8086/">
   http://epocha.pd.mcs.net/Linux8086/</a>. At the moment this archive doesn't
 seem to be working. There was an unofficial linux-8086 mailing list archive
 at <a href="http://www.cyberpass.net/%7Edummy/robert/archives/linux-8086/">
   http://www.cyberpass.net/~dummy/robert/archives/linux-8086/</a> which
seems  to be down at the moment.  </p>
 
<p> Note that ELKS is not Linux, and the mailing list is <i>not</i> a suitable 
 place for posting questions about Linux (despite its name). These would be
 better sent to one of the Linux-specific newsgroups such as <a href="news:comp.os.linux.misc">
  comp.os.linux.misc</a></p>
 
<h2>Section 1 - General</h2>
 
<ul>
   
  <li><a href="#1.1">Q1.1. What is ELKS?</a></li>
   
  <li><a href="#1.2">Q1.2. How does ELKS compare with standard Linux?</a></li>
   
  <li><a href="#1.3">Q1.3. Are there any ready-to-run distributions of ELKS?</a></li>
   
  <li><a href="#1.4">Q1.4. Can ELKS run on an 8088?</a></li>
 
</ul>
 
<h2>Section 2 - Compiling and installing</h2>
 
<ul>
   
  <li><a href="#2.1">Q2.1. Where can I find the source?</a></li>
   
  <li><a href="#2.2">Q2.2. How do I make an ELKS kernel?</a></li>
   
  <li><a href="#2.3">Q2.3. I get an error saying that /usr/include/linux/vm86.h
 does not exist</a></li>
   
  <li><a href="#2.4">Q2.4. How do I make an 'init' for ELKS?</a></li>
   
  <li><a href="#2.5">Q2.5. How do I make a root filesystem disk?</a></li>
   
  <li><a href="#2.6">Q2.6. What if I have an XT with a 360K disk drive?</a></li>
   
  <li><a href="#2.7">Q2.7. How do a change root device of boot images?</a></li>
   
  <li><a href="#2.8">Q2.8. How do I install to a harddis</a></li>
 
</ul>
 
<h2>Section 3 - Networking</h2>
 
<ul>
    
</ul>
<h2> </h2>
 
<h2>Section 4 - Using ELKS</h2>
 
<ul>
   
  <li><a href="#4.1">Q4.1. Can I run bcc binaries under Linux?</a></li>
   
  <li><a href="#4.2">Q4.2. Can I boot ELKS under DOSEMU?</a></li>
 
</ul>
 
<h2>Section 5 - Unanswered questions</h2>
 
<hr> 
<h2>Section 1 - General</h2>
 
<h3><a name="1.1">Q1.1. What is ELKS?</a></h3>
    ELKS is the Embeddable Linux Kernel Subset, a project to build a small
 kernel subset Linux (which will provide more or less UNIX V7 functionality
 within the kernel) that can run on machines with limited processor and memory
 resources. The initial proposed targets are the Intel 8086 and eventually
 the 286's 16-bit protected mode.  A kernel that can run on this kind of
hardware  is useful for embedded systems projects, for third world deployment
where  80x86 x&gt;0 machines are not easily available, and for use on various
palmtops.   
<p> More information on the background, goals and current status of the project 
 can be found at the <a href="http://www.uk.linux.org/Linux8086.html">ELKS
 home page</a>.  </p>
 
<h3><a name="1.2">Q1.2. How does ELKS compare with standard Linux?</a></h3>
    ELKS is intended as a subset of true Linux, and ought to be small enough
 to be understood by one person, so it should be invaluable as a learning
tool. It is in the <i>very</i> early stages of development, and big chunks
are missing, such as swapping, shared libraries. Having said that, it is
already able to boot, provide virtual consoles and access the network with
TCP/IP.    
<h3><a name="1.3">Q1.3. Are there any ready-to-run distributions of ELKS?</a></h3>
    Not yet. You need to use a standard Linux machine, download the sources,
 and cross-compile to generate the 8086 target code.  Boot and root disk
images  are provided with the current version of ELKS,  but all they do is
act as  a platform for testing the system,  very little can be done with
them. <a href="mailto:mstrates@linloft.apana.org.au">  Michael Strates</a>
 has volunteered to put together a distribution, which  he is currently working
on.    
<h3><a name="1.4">Q1.4. Can ELKS run on an 8088?</a></h3>
    The 8088 is identical to the 8086, except it has an 8-bit external data
 bus instead of 16-bit (and thus is slower). So yes, ELKS will run on it. 
   
<hr> 
<h2>Section 2 - Compiling and Installing</h2>
 
<h3><a name="2.1">Q2.1. Where can I find the source?</a></h3>
    The primary site  <a href="ftp://linux.mit.edu/pub/ELKS">ftp://linux.mit.edu/pub/ELKS</a>
   is now back up. Other sites where ELKS and Dev86 can be found are:   
<p><a href="ftp://ftp.ecs.soton.ac.uk/pub/elks/"> ftp://ftp.ecs.soton.ac.uk/pub/elks/</a><br>
 <a href="ftp://cam053212.student.utwente.nl/pub/8086-nix/ELKS/"> ftp://cam053212.student.utwente.nl/pub/8086-nix/ELKS/</a><br>
 <a href="ftp://tsx-11.mit.edu/pub/linux/ALPHA/linux-16/"> ftp://tsx-11.mit.edu/pub/linux/ALPHA/linux-16/</a><br>
 <a href="ftp://src.doc.ic.ac.uk/packages/linux/tsx-11-mirror/ALPHA/linux-16/">
   ftp://src.doc.ic.ac.uk/packages/linux/tsx-11-mirror/ALPHA/linux-16/</a><br>
 <a href="ftp://ftp.amscons.com/pub/mirrors/ELKS"> ftp://ftp.amscons.com/pubi/mirrors/ELKS</a><br>
 </p>
 
<p> If you know of any others or wish to set one up, please contact the  maintainer.
 </p>
 
<h3><a name="2.2">Q2.2. How do I make an ELKS kernel?</a></h3>
   Download <tt>dev86/Dev86-0.0.13.4.tar.gz</tt> and <tt>kernel/elks-0.0.67/elks-0.0.67.tar.gz</tt>
   (or the latest versions) from linux.mit.edu, or one of the other sites.
  Unpack Dev86 them into /usr/src (or any other convenient directory), and
 elks into /usr/src/linux-86  <pre>    tar -xvzf Dev86-0.0.13.tar.gz -C /usr/src<br>    tar -xvzf elks-0.0.67.tar.gz -C /usr/src<br></pre>
   The development environment will be created in /usr/src/linux-86, and
the  kernel source in /usr/src/elks. Next you have to build the development
tools,  which include the <b>bcc</b> compiler: <pre>    cd /usr/src/linux-86<br>    make install<br></pre>
   Next, compile the kernel. <pre>    cd /usr/src/elks<br>    # Build kernel<br>    make config<br>    make dep<br>    make<br></pre>
   Make config works in the same way as the main Linux kernel. The default
  configuration will work on almost all systems. Don't change any of the
options  unless you know what you are doing.  
<p> (If you're used to building Linux kernels with gcc, you'll be amazed
at how quick this is! :-) The result is a floppy disk image called "Image", 
 which you can copy to a formatted floppy and boot from. <pre>    dd if=Image of=/dev/fd0<br></pre>
   or <pre>    make disk<br></pre>
   You should now be able to boot with this disk, but you won't get much
further  without a root floppy disk for it to mount. You'll need to use bcc
to compile  an 'init' program and make a root minix filesystem. This is explained
further  down.  </p>
 
<h3><a name="2.3">Q2.3. I get an error saying that /usr/include/linux/vm86.h
 does not exist</a></h3>
    Edit <tt>/usr/include/sys/vm86.h</tt>, and change <tt>#include &lt;linux/vm86.h&gt;</tt>
   to <tt>#include &lt;asm/vm86.h&gt;</tt> 
<h3><a name="2.4">Q2.4. How do I make an 'init' for ELKS?</a></h3>
    After the ELKS kernel has booted it will run /bin/init.   
<p> A real version of 'init' is being prepared for inclusion in the tiny-utils 
 package, also on linux.mit.edu. The kernel code has recently been changed
  so that it loads /bin/init instead of /bin/sh. </p>
 
<p> Kernel 0.0.67 includes a set of utilities in kernel/elks-0.0.67/elkscmd.tar.gz,
 which contains an init and a login (without password verification). To install
 them compile them both with <pre>    bcc -0 -O -s init.c -o init<br>    bcc -0 -O -s login.c -o login<br></pre>
   and copy them into the /bin directory of your root disk. login requires
 an  /etc/passwd and a /etc/group file, and a /bin/sh (or other depending
on the entry in /etc/passwd. </p>
 
<p><code>-0</code> selects 8086 code generation, <code>-O</code> enables
optimisation, <code>-ansi</code> enables ansi-style function prototypes (only),
and <code> -s</code> strips symbols out of the binary. </p>
 
<p> As kernel 0.0.56 sash now works and is being used as /bin/sh by most
people. It can be found in elkscmd.tar.gz. For best results copy /etc/passwd
and /etc/group from a standard linux distribution onto your root disk so
that ls -l works okay, and /usr/lib/liberror.txt so that sash error reporting
works. </p>
 
<h3><a name="2.5">Q2.5. How do I make a root filesystem disk?</a></h3>
    You need to create a minix floppy containing the appropriate bits and 
pieces. This file should contain init, login, and sh in /bin/ and passwd and
group in /etc/, as well as three ttys for init in /dev/. <br>
 <i>Note: /dev/tty is different to normal Linux which uses (5,0)</i><pre>    mkdir /usr/src/root86<br>    cd /usr/src/root86<br>    mkdir dev<br>    cd dev<br>    mknod tty c 4 0<br>    mknod tty2 c 4 1<br>    mknod tty3 c 4 2<br>    mknod fd0 b 3 128<br>    cd ..<br>    mkdir bin<br>    cd bin<br>    cp &lt;path-to-elkscmd-init&gt; init<br>    cp &lt;path-to-elkscmd-login&gt; login<br>    cp &lt;path-to-elkscmd-sash&gt; sh<br>    cd ..<br>    mkdir etc<br>    cd etc<br>    cp &lt;path-to-skeleton-passwd&gt; passwd<br>    cp &lt;path-to-skeleton-group&gt; group<br>    cd ..<br>    fdformat /dev/fd0H1440      # if floppy not yet formatted<br>    mkfs -t minix -n14 /dev/fd0 1440<br>    mount -t minix /dev/fd0 /a  # need a mount point "/a"<br>    cp -pR /usr/src/root86/* /a<br>    umount /a<br></pre>
   Some distributions use /dev/fd0u1440 instead of /dev/fd0H1440.  
<p> You should removed passwords from the passwd file as they are not yet 
 suported, and make sure the shell entry for each user is /bin/sh for future 
 compatability.</p>
 
<p> Alternatively, if you have a 2.0.x kernel and mount-2.5k, you can use
 the loopback filesystem to create a disk image on your hard disk, and then 
 dump it to floppy <pre>    dd if=/dev/zero of=root.image bs=18k count=80<br>    losetup /dev/loop0 root.image<br>    mkfs -t minix /dev/loop0 1440<br>    mount -t minix /dev/loop0 /a<br>    ...<br>    umount /a<br>    dd if=root.image of=/dev/fd0<br></pre>
   As of ELKS 0.0.53 floppy sizes other than 1.44M now work. Just follow
the  above intructions substituting the appropriate sizes in where required. 
However, because of the way 360K disks are written by 1.2Meg drives, the instructions
below must be followed if you are trying to boot a machine with a 360K drive.
 </p>
 
<h3><a name="2.6">Q2.6. What if I have an XT with a 360K disk drive?</a></h3>
    Preparing boot and root images to run on a different machine requires 
a  little care, especially if the target machine has a 360K drive. 360K drives 
 (5.25" DD) have 40-track heads, and 1.2MB (5.25" HD) have 80-track heads. 
 A 1.2MB drive can read 360K disks but not reliably write them, since it will
write magnetic tracks which are half the width expected by a 360K drive. 
 
<p> One solution is to fit a 360K drive as the second drive in your Linux
 PC - you can then format 360K disks with <tt>fdformat /dev/fd1d360</tt>
and  create filesystems as usual. </p>
 
<p> Otherwise, you will need to create a floppy disk image file, transfer
 it to the PC which has the 360K drive (e.g. using a serial cable), then
use  "rawrite" under DOS to recreate the disk from the image file.  </p>
 
<h4>Boot disks</h4>
    The 'Image' file can be written to any type of floppy disk and will boot 
 successfully, so all you need to do is transfer the file and use 'rawrite' 
 to make the target disk.   
<p> Root disks are now autodetected so you no longer have to re-compile for
 disk sizes other than 1.44Mb.  </p>
 
<h4>Root disks</h4>
    You can prepare a 360K root image on a larger drive - when you enter
the  mkfs command substitute '360' for the size of the filesystem. Once you
have  copied the files to this disk, unmount it, then you can create a disk
image  file from it: <pre>        dd if=/dev/fd0 of=root.image bs=1k count=360<br></pre>
   This image can then be transferred to the target and written out using 
'rawrite' as before. If you use the loopback filesystem this step is not necessary.
    
<h4>RAM limitations</h4>
    0.0.44 expected there to be 640K RAM available. However if you do not 
have  640K the problems with DEF_INITSEG and DEF_SETUPSEG have now been fixed 
in  later versions so you will not have to change anything.   
<h3><a name="2.7">Q2.7. How do a change root device of boot images?</a></h3>
   Version 0.0.62 boot disk was compiled to use the second floppy drive as
  a root disk because the wait_for_keypress() function was broken. You can
 get  round this if you only have one floppy drive by using a hex editor
to  change the root device no. in the image.  
<p> If you get an error about root disk mount failing on device 03c0, load
 the boot image into a hex editor and look for c003h somewhere near the start 
 of the image and change it to 8003h. (c003h is 03c0 in Intel's backwards 
byte ordering). This should work for any version, but it is not clear whether
 the address of the byte to edit varies between version. <a href="mailto:jose@cnct.com">
  jose@cnct.com</a> reports that in 0.0.62 boot image, the two bytes are
at  0adf - oade. </p>
 
<h3><a name="2.8">Q2.8. How do I install to ELKS to harddisk?</a></h3>
   As of version 0.0.65 it is possible to install ELKS root disk on a harddisk 
 and then create a boot floppy that uses this. There still some bugs but it
is more usable than a root floppy.  
<p> First create a partition with fdisk. Any version of fdisk will be able
 to do this, but the current root disk only supports hd?1-4, which are primary 
 partitions, and if you already have a DOS primary partition you will not
 be able to make a second primary partition with DOS fdisk. The version of 
 fdisk included on the ELKS 0.0.67 root disk is still young code, but seems
 to work fine on my system.</p>
 
<p> Having created the partition, boot ELKS from boot and root floppies,
and create a filesystem using mkfs. It is safe to use ELKS fdisk to check
you know the correct device name for the partition you want to create the
filesystem on. To create the filesystem type <pre>    mkfs /dev/hd?? &lt;size&gt;<br></pre>
   where hd?? is the correct partition, and size is the size of the partition 
 in Kbyte blocks. &lt;size&gt; cannot be more than 32M. E.g. To make a filesystem
 on the first partition on the slave disk, which is a 20M partition type:<pre>    mkfs /dev/hdb1 20000<br></pre>
 </p>
 
<p> Now mount the partition on the /mnt mount point by typing<pre>    mount /dev/hd?? /mnt<br></pre>
   where hd?? is the correct partition. The root directory of the new partition 
 may look a bit corrupted and it may not be possibly to use ls from /mnt.
 I am not sure why mkfs is generating slightly corrupt filesystems, but I
am working on it.</p>
 
<p> Create the essential directories on the new filesystem as follows:<pre>    mkdir /mnt/bin<br>    mkdir /mnt/dev<br>    mkdir /mnt/usr<br>    mkdir /mnt/usr/lib<br>    mkdir /mnt/mnt<br>    mkdir /mnt/etc<br>    mkdir /mnt/root<br>    mkdir /mnt/home<br>    mkdir /mnt/home/user?....<br></pre>
 </p>
 
<p> Now copy essential files. You will need many more than these for a decent
  system but here are the essentials and some of the more useful ones.<pre>    cp /bin/init /mnt/bin/init<br>    cp /bin/login /mnt/bin/login<br>    cp /bin/sh /mnt/bin/sh<br>    cp /bin/ls /mnt/bin/ls<br>    cp /bin/pwd /mnt/bin/pwd<br>    cp /bin/mount /mnt/bin/mount<br>    cp /bin/umount /mnt/bin/umount<br>    cp /bin/cp /mnt/bin/cp<br>    cp /etc/passwd /mnt/etc/passwd<br>    cp /etc/group /mnt/etc/group<br>    cp /usr/lib/liberror.txt /mnt/usr/lib/liberror.txt<br></pre>
 </p>
 
<p> Finally create the essentail devices:<pre>    mknod /mnt/dev/tty c 4 0<br>    mknod /mnt/dev/tty2 c 4 1<br>    mknod /mnt/dev/tty3 c 4 2<br>    mknod /mnt/dev/fd0 b 3 128<br>    mknod /mnt/dev/fd1 b 3 192<br>    mknod /mnt/dev/hda b 3 0<br>    mknod /mnt/dev/hda1 b 3 1<br>    mknod /mnt/dev/hda2 b 3 2<br>    mknod /mnt/dev/hda3 b 3 3<br>    mknod /mnt/dev/hda4 b 3 4<br>    mknod /mnt/dev/hdb b 3 64<br>    mknod /mnt/dev/hdb1 b 3 65<br>    mknod /mnt/dev/hdb2 b 3 66<br>    mknod /mnt/dev/hdb3 b 3 67<br>    mknod /mnt/dev/hdb4 b 3 68<br></pre>
 </p>
 
<p> Now unmount the new partition with<pre>    umount /dev/hd??<br></pre>
 </p>
 
<p> You will now need to re-compile a new kernel with the correct root device
  selected. To do this edit include/linuxmt/conmfig.h in the ELKS kernel
sources,  and changed the ROOT_DEV from 0x380 to the device number of the
partition.  The last two digits must be the minor number of the partition
in hex. The  minor number can be found from the list above in the far right
column. E.g.  The minor number for hdb3 is 67, which is 43 in hex, so the
ROOT_DEV value  is 0x343.</p>
 
<p> Type<pre>    make disk<br></pre>
   to build a new kernel floppy, and reboot the ELKS machine with this new
 boot disk. The new root should mount, but may give a warning, and the system
 come up as normal, but much faster than from floppy. As before the root
directory  may be corrupted, but it should be possible to change to other
directories  normally, and the system should work otherwise normally.  </p>
 
<h2>Section 4 - Using ELKS</h2>
 
<h3><a name="3.1">Q4.1. Can I run bcc binaries under Linux?</a></h3>
    Yes - by loading a kernel module you can run ELKS binaries directly.
This  makes development of programs to run under ELKS much less painful,
since  you can test them on your normal Linux system (although they might
not work  under ELKS, if your program uses a kernel facility which is not
yet implemented)  <pre>    cd /usr/src/linux-86/elksemu<br>    make module<br>    insmod binfmt_elks.o<br></pre>
   Note that you will need to rerun the 'insmod' each time you reboot. There 
 are some sample bcc programs you can try in /usr/src/linux-86/tests (such
 as a version of 'wc')   
<p> If when making the module you get an error saying "modversions.h: no such
file or directory" then you need to edit the Makefile to remove the reference
to this file, i.e.: <pre>MODCFLAGS=-D__KERNEL__ -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer \<br>          -fno-strength-reduce -pipe -m486 -DCPU=486 -DMODULE -DMODVERSIONS<br></pre>
 </p>
 
<h3><a name="3.2">Q4.2. Can I boot ELKS under DOSEMU?</a></h3>
    Yes. ELKS can boot inside dosemu 0.63.1.36 running under Linux 2.0.7, 
and  probably other combinations as well. Make sure your floppy drive is configured
 in <tt>/etc/dosemu.conf</tt>, and use the -A flag to dos or xdos if necessary
 to force a floppy boot. <pre>    floppy { device /dev/fd0 threeinch }  <br></pre>
 
<h2> Section 5 - Unanswered questions </h2>
    Answers to these questions would be appreciated!    
<ul>
   
  <li>Can I start ELKS from DOS, like LOADLIN.EXE does for Linux? <a href="mailto:bsittler@mnt.edu">
  Benjamin C. W. Sittler</a> has written a package which can do this called
  <a href="http://www.geocities.com/SiliconValley/Lakes/4535/">BootELKS</a>
  , and would very much like to hear from anyone who uses it, or has problems. 
   </li>
   
  <li>My palmtop has a RAMdrive. Can ELKS access it?     <i>(When/if ELKS
 gets an msdos filesystem, that is)</i></li>
   
  <li>Can I combine the boot and root floppies? <pre>&gt; From: Bar-David Yedidya <didi @math.tau.ac.il=""><br>&gt; <br>&gt; Today I managed to combine root/boot disks using LILO. It just worked!<br>&gt; <br>&gt; I created /boot on the floppy, copied Image and boot.b to it,<br>&gt; put in /etc (on the floppy) lilo.conf with this :<br>&gt; boot=/dev/fd0<br>&gt; compact<br>&gt; image=/boot/Image<br>&gt;         label=lin16<br>&gt; did lilo -r /mnt<br>&gt; and Hopla!<br>&gt; I didn't look at the kernel sources yet to compare the boot code of linux<br>&gt; and linux-16, but I guess they act the same, and that's why lilo worked.<br></didi></pre>
   There are reports this broke under the recent ELKS versions (&gt;0.0.46?) 
     <i>Note - will this work on pre 386 machines?</i>     
    <p>Chad Page is working on a single disk system which should be in the
 next  version. </p>
   </li>
 
</ul>
 
<hr> 
<address><a href="mailto:ajr@ecs.soton.ac.uk">Alistair Riddoch</a> / last
 updated 15th July 1997 </address>
 
</body>
</html>
